<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Thwarting &ldquo;Spoofy&rdquo; Business with SPF, DKIM, and DMARC Most of us have received emails that look like they’re from a trusted source but are actually from cybercriminals."><meta property="og:title" content><meta property="og:description" content="Thwarting &ldquo;Spoofy&rdquo; Business with SPF, DKIM, and DMARC Most of us have received emails that look like they’re from a trusted source but are actually from cybercriminals."><meta property="og:type" content="website"><meta property="og:image" content="https://blog.griff.systems/icon.png"><meta property="og:url" content="https://blog.griff.systems/published/2024/thwarting-spoofy-business-with-spf-dkim-dmarc/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Thwarting &ldquo;Spoofy&rdquo; Business with SPF, DKIM, and DMARC Most of us have received emails that look like they’re from a trusted source but are actually from cybercriminals."><meta name=twitter:image content="https://blog.griff.systems/icon.png"><title>blog.griff.systems</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://blog.griff.systems//icon.png><link href=https://blog.griff.systems/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://blog.griff.systems/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://blog.griff.systems/js/darkmode.c869d3a61240a800a16e2c2547d7ba0e.min.js></script>
<script src=https://blog.griff.systems/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://blog.griff.systems/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://blog.griff.systems/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://blog.griff.systems/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://blog.griff.systems/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!1,PRODUCTION=!0,BASE_URL="https://blog.griff.systems/",fetchData=Promise.all([fetch("https://blog.griff.systems/indices/linkIndex.e9ce587c930e98fb1290f16e8e0ac277.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://blog.griff.systems/indices/contentIndex.f53c0c70b6e677220dc21555c9286d96.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://blog.griff.systems",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://blog.griff.systems",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=()=>{addCopyButtons(),addTitleToCodeBlocks()}</script><script type=module>
    import { attachSPARouting } from "https:\/\/blog.griff.systems\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=blog.griff.systems src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://blog.griff.systems/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://blog.griff.systems/>blog.griff.systems</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Nov 7, 2024</p><ul class=tags></ul><a href=#thwarting-spoofy-business-with-spf-dkim-and-dmarc><h1 id=thwarting-spoofy-business-with-spf-dkim-and-dmarc><span class=hanchor arialabel=Anchor></span>Thwarting &ldquo;Spoofy&rdquo; Business with SPF, DKIM, and DMARC</h1></a><p>Most of us have received emails that look like they’re from a trusted source but are actually from cybercriminals. With phishing attempts and cybersecurity incidents being commonplace in the modern work environment, IT teams these days focus heavily on a variety of security measures including user education. Email is a core part of most businesses&rsquo; communication, and setting up authentication on email messages is a straightforward way to help mitigate the risk of bad actors from sending email message that look like they&rsquo;re from your company when they&rsquo;re really not. This protection takes the form of three different parts: SPF, DKIM, and DMARC.</p><a href=#sender-policy-framework-spf><h2 id=sender-policy-framework-spf><span class=hanchor arialabel=Anchor></span>Sender Policy Framework (SPF)</h2></a><p>Imagine if every time someone received a letter in via the postal service, the back of the envelope said &ldquo;if the return address on the front isn&rsquo;t my address, don&rsquo;t deliver this letter&rdquo; and the letter carrier would discard it. In a way, that&rsquo;s what the Sender Policy Framework&ndash;or &ldquo;SPF&rdquo;&ndash;is. SPF is like a list of approved senders for your domain. When the recipient&rsquo;s mail server receives your email, it uses DNS to look up a TXT record for the domain that you sent your email from; this record contains the list of places that are approved to send email for your domain.</p><p>As an example, if you have a mail server with a public IP address of 52.96.165.98 (this is just a random Office 365 IP address as an example, but you&rsquo;d use your public IP address that your mail server sends from) and that mail server sends mail as
<a rel=noopener class="internal-link broken" data-src=mailto:user@domain.tld>user@domain.tld</a>, the recipient&rsquo;s mail server will do a DNS lookup for domain.tld and find the TXT record that is the SPF record. They look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;v=spf1 ipv4:52.96.165.98 -all&#34;
</span></span></code></pre></td></tr></table></div></div><p>The recipient&rsquo;s mail server sees that domain.tld messages should come strictly from 52.96.165.98, and that the message did indeed come from that IP address, so it will pass the SPF check. If the source of the message is not included in the sender domain&rsquo;s SPF record, then the message will fail the SPF check. This helps unauthorized sources from sending emails that look like they&rsquo;re from you, but actually are not. There are limitations to SPF&rsquo;s efficacy, such as when a message is forwarded (the source IP address of the message may change to an address not in your domain&rsquo;s SPF record), but for this high-level overview we won&rsquo;t go into all of those. In any case, SPF is easy to enable and a worthy protection to put in place for your domain.</p><a href=#domainkeys-identified-mail-dkim><h2 id=domainkeys-identified-mail-dkim><span class=hanchor arialabel=Anchor></span>DomainKeys Identified Mail (DKIM)</h2></a><p>To add another layer of security, DomainKeys Identified Mail&ndash;or &ldquo;DKIM&rdquo;&ndash;adds a digital signature to your emails, ensuring they haven’t been tampered with during transit. Imagine you and the recipient have a secret way to verify that the contents of an envelope haven’t been tampered with—like placing a distinctive mark on the seal. This is similar to what DKIM does with email."</p><p>While not an exact example, this is similar to what DKIM does. Using a cryptographic key pair (public and private), outbound emails are signed, and the recipient&rsquo;s mail servers can check the signature against the DKIM information published in a TXT record for your domain to make sure that the email really did come from where it said it did, and that it was not tampered with in transit.</p><p>This is a strong protection for email, but it is limited by the fact that it requires key management, which is not supported by every platform and service provider. Some will fully support it, some will partially support it, and some outright don&rsquo;t support DKIM at all. Key management can become burdensome and is typically the responsibility of the domain&rsquo;s administrator. That said, if you use platforms largely popular with enterprises, there&rsquo;s a good chance that DKIM is supported, and if it is supported, there&rsquo;s a good chance you should configure it.</p><a href=#domain-based-message-authentication-reporting-and-conformance-dmarc><h2 id=domain-based-message-authentication-reporting-and-conformance-dmarc><span class=hanchor arialabel=Anchor></span>Domain-based Message Authentication, Reporting, and Conformance (DMARC)</h2></a><p>Finally, there is Domain-based Message Authentication, Reporting, and Conformance&ndash;also known as &ldquo;DMARC&rdquo;. In the analogy, if the return address is wrong and the envelope seal is missing the distinctive mark, the recipient would likely toss it out. This is what DMARC does—providing instructions on how to handle messages that fail the SPF or DKIM checks.</p><p>This protective measure acts as a policy/enforcement layer for SPF and DKIM, providing instructions as to how messages not authenticated by SPF or DKIM should be handled. DMARC checks if the incoming email message passes SPM and DKIM checks, then decides whether to accept, quarantine, or reject messages that fail those checks.</p><p>Like SPF and DKIM, this is accomplished using TXT records in your domain&rsquo;s public DNS. Not only does this help prevent spoofing, but it provides visibility as to who is sending on behalf of your domain. Unlike SPF and DKIM, DMARC has those two checks as dependencies, and cannot be used by itself. While it has these requirements, it also relies on simple DNS records, and there are relatively few (if any) valid reasons to disregard setting up DMARC.</p><p>As an aside, because this is the policy/enforcement layer and management of larger quantities of domains can become cumbersome, businesses with many domains may benefit from using a third-party DMARC management tool to put all of the policies in a single place for ease of management and visibility. There are a variety of them available, including popular options such as
<a href=https://dmarcly.com/ rel=noopener>dmarcly</a> and
<a href=https://www.mimecast.com/products/dmarc-analyzer/ rel=noopener>Mimecast DMARC Analyzer</a>.</p><hr><p>All together SPF, DKIM, and DMARC form an effective email security strategy. SPF dictates who can send mail for your domain, DKIM ensures the integrity of messages supposedly sent from your domain, and DMARC provides policies and enforcement to catch unauthorized emails. Understanding and implementing all three of these methods adds a significant level of protection against bad actors who are getting up to &ldquo;spoofy&rdquo; business and trying to send email-based threats your way and is something that you should consider doing if you have not already set it up.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/toc/ data-ctx='Thwarting "Spoofy" Business with SPF, DKIM, and DMARC' data-src=/toc class=internal-link>Table of Contents</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://blog.griff.systems/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Barker, Griffeth using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2024</p><ul><li><a href=https://blog.griff.systems/>Home</a></li><li><a href=https://mastodon.social/@kalipike>Follow me on Mastodon</a></li><li><a href=https://matrix.to/#/@kalipike:matrix>Chat with me on Matrix</a></li></ul></footer></div></div></body></html>