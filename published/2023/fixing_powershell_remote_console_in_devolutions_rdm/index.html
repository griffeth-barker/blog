<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Special Thanks Special thanks to Marc-André Moreau, whose expertise and assistance on the Devolutions Forum led to this workaround."><meta property="og:title" content="Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager"><meta property="og:description" content="Special Thanks Special thanks to Marc-André Moreau, whose expertise and assistance on the Devolutions Forum led to this workaround."><meta property="og:type" content="website"><meta property="og:image" content="https://blog.griff.systems/icon.png"><meta property="og:url" content="https://blog.griff.systems/published/2023/fixing_powershell_remote_console_in_devolutions_rdm/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager"><meta name=twitter:description content="Special Thanks Special thanks to Marc-André Moreau, whose expertise and assistance on the Devolutions Forum led to this workaround."><meta name=twitter:image content="https://blog.griff.systems/icon.png"><title>Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://blog.griff.systems//icon.png><link href=https://blog.griff.systems/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://blog.griff.systems/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://blog.griff.systems/js/darkmode.c869d3a61240a800a16e2c2547d7ba0e.min.js></script>
<script src=https://blog.griff.systems/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://blog.griff.systems/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://blog.griff.systems/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://blog.griff.systems/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://blog.griff.systems/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!1,PRODUCTION=!0,BASE_URL="https://blog.griff.systems/",fetchData=Promise.all([fetch("https://blog.griff.systems/indices/linkIndex.936f25950107e272fe15dc2273f0a64f.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://blog.griff.systems/indices/contentIndex.9b7550d8eadeb3233dac72821577957d.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://blog.griff.systems",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://blog.griff.systems",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=()=>{addCopyButtons(),addTitleToCodeBlocks()}</script><script type=module>
    import { attachSPARouting } from "https:\/\/blog.griff.systems\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=blog.griff.systems src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://blog.griff.systems/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://blog.griff.systems/>blog.griff.systems</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager</h1><p class=meta>Last updated
Oct 27, 2023</p><ul class=tags><li><a href=https://blog.griff.systems/tags/break-fix/>Break fix</a></li><li><a href=https://blog.griff.systems/tags/remote-desktop-manager/>Remote desktop manager</a></li><li><a href=https://blog.griff.systems/tags/devolutions/>Devolutions</a></li><li><a href=https://blog.griff.systems/tags/powershell/>Powershell</a></li><li><a href=https://blog.griff.systems/tags/Terminal/>Terminal</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents></nav></details></aside><blockquote><p><strong>Special Thanks</strong>
<em>Special thanks to
<a href=https://forum.devolutions.net/users/25115/mamoreau rel=noopener><strong>Marc-André Moreau</strong></a>, whose expertise and assistance on the Devolutions Forum led to this workaround.</em></p></blockquote><blockquote><p><strong>Disclaimer</strong>
<em>Please note that I am not affiliated with nor supported by Devolutions or their staff, and if you experience issues with your Remote Desktop Manager application, you should probably contact their technical support or post on their forum. I am not an RDM developer, thus the explanations contained herein are the result of my best understanding based on interactions with Devolutions staff, and are not guaranteed to be completely accurate. As always, you should consult technical support for any issues; additionally, you should fully understand fully any command or script before running them on your or any other system.</em></p></blockquote><a href=#problem><h1 id=problem><span class=hanchor arialabel=Anchor></span>Problem</h1></a><p>Launching a Remote PowerShell Console session entry in Devolutions Remote Desktop Manager results in the following error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Invoke-Expression : Exception setting &#34;BufferSize&#34;: &#34;Cannot set the buffer size because the size specified is too large or too small.
</span></span><span class=line><span class=cl>Parameter name: value
</span></span><span class=line><span class=cl>Actual value was 192,4000.&#34;
</span></span><span class=line><span class=cl>At line:32 char:13
</span></span><span class=line><span class=cl>+             Invoke-Expression $SecureCommand
</span></span><span class=line><span class=cl>+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : NotSpecified: (:) [Invoke-Expression], SetValueInvocationException
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : ExceptionWhenSetting,Microsoft.PowerShell.Commands.InvokeExpressionCommand
</span></span></code></pre></td></tr></table></div></div><a href=#environment><h1 id=environment><span class=hanchor arialabel=Anchor></span>Environment</h1></a><p>I identified this issue in Remote Desktop Manager version 2023.2.28.0, though Devolutions forums indicate such issues may have existed in prior versions as well. The workstation with RDM installed was Windows 11 23H2 with Windows PowerShell 5.1 as the default PowerShell environment, though the issue appears to be operating system agnostic, as well as architecture agnostic.</p><p>During troubleshooting, I found that if I installed PowerShell 7 and set the entry&rsquo;s terminal type to PowerShell 7 instead of Default or Windows PowerShell 5.1 and changed the shell type from Console Host to Windows Terminal, that I was able to use the session entry as expected, though this requires the deployment of PowerShell 7 to RDM users, which may not meet the needs of all organizations and environments.</p><a href=#background><h1 id=background><span class=hanchor arialabel=Anchor></span>Background</h1></a><p>RDM&rsquo;s PowerShell Remote Console session type is supposed to natively handle both Windows PowerShell 5.1 and PowerShell 7.</p><p>When RDM opens the PowerShell Remote Console session, RDM calls <code>conhost.exe</code> then resizes it using an injected command and reparents it into a docked tab within the RDM application interface. The specified PowerShell environment appears to then be opened inside of the Console Host, and then an inbuilt script is run which establishes a PSSession to the host specified in the session entry&rsquo;s properties.</p><p>The Console Host was not intended to be embedded into other applications. Because of this, the Console Host must be resized before reparenting it into RDM.</p><blockquote><p><strong>Note on Windows Terminal</strong>
Windows Terminal, the new terminal made default in Windows 11, does not support reparenting at all; if you do choose the Windows Terminal option in the session entry&rsquo;s properties, RDM will use a
<a href=https://github.com/Devolutions/wt-distro rel=noopener>Devolutions custom distribution of the Microsoft Windows Terminal</a>, which was developed specifically to support integration with RDM via launching with a parent window, avoiding the need for reparenting after it has launched.</p></blockquote><a href=#cause><h1 id=cause><span class=hanchor arialabel=Anchor></span>Cause</h1></a><p>This issue results from this resizing and reparenting process. When the Console Host is resized, there are two minimums which need to be taken into account:</p><ul><li><code>$Host.UI.RawUI.BufferSize</code></li><li><code>$Host.UI.RawUI.WindowSize</code></li></ul><p>The Console Host&rsquo;s window size must be changed before the buffer size is set. The code to shrink the window <em>first</em> is not yet existent in RDM. If the Buffer size is set first and the values for this property are incompatible with the Window size, the exception shown in the Problem section of this article will be thrown.</p><a href=#workaround><h1 id=workaround><span class=hanchor arialabel=Anchor></span>Workaround</h1></a><p>The minimum Buffer Size is determined by GetSystemMetrics(SM_CXMIN) + GetSystemMetrics(SM_CYMIN) in Windows. These values can be determined using the following code snippet:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nb>Add-Type</span> <span class=n>-TypeDefinition</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    using System.Runtime.InteropServices;
</span></span></span><span class=line><span class=cl><span class=sh>
</span></span></span><span class=line><span class=cl><span class=sh>    public class User32 {
</span></span></span><span class=line><span class=cl><span class=sh>        [DllImport(&#34;user32.dll&#34;)]
</span></span></span><span class=line><span class=cl><span class=sh>        public static extern int GetSystemMetrics(int nIndex);
</span></span></span><span class=line><span class=cl><span class=sh>    }
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$cxmin</span> <span class=p>=</span> <span class=no>[User32]</span><span class=p>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>28</span><span class=p>)</span> <span class=c># SM_CXMIN</span>
</span></span><span class=line><span class=cl><span class=nv>$cymin</span> <span class=p>=</span> <span class=no>[User32]</span><span class=p>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>29</span><span class=p>)</span> <span class=c># SM_CYMIN</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;SM_CXMIN: $cxmin SM_CYMIN: $cymin&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Sample output:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SM_CXMIN: 136 SM_CYMIN: 39
</span></span></code></pre></td></tr></table></div></div><p>I set my PowerShell terminal&rsquo;s Window size and Buffer size to these values using:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$Host.UI.RawUI.WindowSize = New-Object System.Management.Automation.Host.Size 136,39
</span></span><span class=line><span class=cl>$Host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size = 136,39
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Note that if you were to run these two commands in reverse order the first time, you&rsquo;d likely have the same exception described in the Problem section of this post thrown again.</p></blockquote><p>In Remote Desktop Manager, go to <em>File > Options > Types > Other</em> and then locate the PowerShell section. I changed the Buffer size Rows to the <code>136</code> value and the Buffer size Cols to the <code>39</code> value, though the Cols value then forced itself to 50, which I left alone.</p><p>In the same section, I also changed the Window size Rows to the <code>136</code> value and the Window size Cols value to the <code>39</code>. Save these options changes.</p><p>Then, for the session entry in question, navigate to <em>Properties > General > Advanced</em> and uncheck the <strong>Resize window</strong> checkbox, then save the changes.</p><p>At this point, I was be able to launch the session entry, the process described in the Background section of this post worked properly, and the end result was a PSSession to the host defined in the session entry&rsquo;s properties.</p><a href=#additional-resources><h1 id=additional-resources><span class=hanchor arialabel=Anchor></span>Additional Resources</h1></a><ul><li>This is the forum post that I revived where I discussed the issue with a developer from Devolutions and eventually reached the workaround provided in this article, despite it being a slightly different issue:
<a href=https://forum.devolutions.net/topics/31127/embedded-powershell-tools--potential-bug-found-with-it rel=noopener>Embedded powershell tools - potential bug found with it.. (devolutions.net)</a></li><li>You can find the Devolutions-developed distribution of Windows Terminal on
<a href=https://github.com/Devolutions/wt-distro rel=noopener>GitHub</a>.</li><li>Information on the SetConsoleScreenBufferSize function in the Console API can be found on
<a href=https://learn.microsoft.com/en-us/windows/console/setconsolescreenbuffersize rel=noopener>Microsoft Learn</a>.</li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/drafts/toc_by_year/ data-ctx="Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager" data-src=/drafts/toc_by_year class=internal-link>Table of Contents</a></li><li><a href=/toc/ data-ctx="Fixing PowerShell Remote Console in Devolutions Remote Desktop Manager" data-src=/toc class=internal-link>Table of Contents</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://blog.griff.systems/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Griff Barker using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2025</p><ul><li><a href=https://blog.griff.systems/>Home</a></li><li><a href=https://griff.systems/bluesky>Follow me on BlueSky</a></li><li><a href=https://griff.systems/linkedin>Connect with me on LinkedIn</a></li><li><a href=https://griff.systems/github>Follow me on GitHub</a></li><li><a href=https://griff.systems/signal>Message me on Signal</a></li></ul></footer></div></div></body></html>